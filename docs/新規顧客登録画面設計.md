# 新規顧客登録画面 詳細設計

## 画面の目的
初回来店または問い合わせ顧客の情報を素早く・正確に記録し、適切な接客につなげる

## 利用シーン

### シーン1: 展示場ふらっと来店
```
お客様が展示車を見ている
→ スタッフが声かけ
→ iPadを取り出して「お名前をお聞かせください」
→ 1-2分で基本情報を登録
→ すぐに接客開始
```

### シーン2: 電話問い合わせ
```
電話で在庫確認の問い合わせ
→ 通話しながらiPadで顧客情報入力
→ 「今度お時間あるときにお越しください」
→ 来店予約も同時に設定
```

### シーン3: WEB問い合わせフォロー
```
カーセンサーからの問い合わせを確認
→ 電話連絡時に詳細情報を追加入力
→ 「実車をご覧になりませんか？」
→ 来店予約へ誘導
```

## 画面レイアウト（iPad縦向き）

```
┌─────────────────────────────┐
│ 🏠 新規顧客登録    [完了] [キャンセル] │
├─────────────────────────────┤
│                              │
│ 基本情報 ⭐必須                │
│ ┌─────────────────────────┐ │
│ │ お名前 *                   │ │
│ │ [山田　太郎              ] │ │
│ └─────────────────────────┘ │
│                              │
│ ┌─────────────────────────┐ │
│ │ 電話番号 *                 │ │
│ │ [090-1234-5678          ] │ │
│ └─────────────────────────┘ │
│                              │
│ ┌─────────────────────────┐ │
│ │ メールアドレス              │ │
│ │ [yamada@example.com     ] │ │
│ └─────────────────────────┘ │
│                              │
│ 来店情報                     │
│ 来店目的: [見学  ][購入検討  ]  │
│          [情報収集][その他  ]  │
│                              │
│ 同伴者:  [お一人 ][ご夫婦   ]  │
│         [ご家族 ][友人同伴  ]  │
│                              │
│ 簡単なニーズ聞き取り             │
│ ご希望車種: [____________]      │
│ 予算:      [100-150万円 ▼]     │
│ 使用用途:   [通勤用     ▼]     │
│                              │
│ [📸 免許証撮影で自動入力]         │
│                              │
│ [   今すぐ接客開始   ]           │
│ [   詳細は後で入力   ]           │
└─────────────────────────────┘
```

## 入力項目詳細

### 必須項目（⭐）
| 項目 | 入力形式 | バリデーション | 備考 |
|------|---------|---------------|------|
| お名前 | テキスト | 必須、2-20文字 | 姓名で分離 |
| 電話番号 | 数字 | 必須、ハイフン自動挿入 | 重複チェック |

### 準必須項目
| 項目 | 入力形式 | 説明 |
|------|---------|------|
| メールアドレス | テキスト | 見積もり送付で必要 |
| 来店目的 | 選択式 | 接客方針決定に使用 |
| 同伴者 | 選択式 | 提案内容調整に使用 |

### 任意項目（聞けたら入力）
| 項目 | 入力形式 | 説明 |
|------|---------|------|
| ご希望車種 | テキスト + 予測変換 | 在庫検索に活用 |
| 予算 | 選択式スライダー | 価格帯絞り込み |
| 使用用途 | 選択式 | 車種提案に活用 |

## 便利機能

### 1. 免許証撮影機能
```
[📸 免許証撮影で自動入力] ボタン
↓
カメラ起動
↓
OCR で氏名・住所・生年月日を自動読み取り
↓
確認画面で修正可能
↓
一括入力完了
```

### 2. 音声入力機能
```
名前入力欄で🎤マークタップ
↓
「やまだ たろう」と発音
↓
「山田太郎」に変換
↓
確認して決定
```

### 3. QRコード生成機能
```
基本情報入力完了
↓
顧客専用QRコード自動生成
↓
「次回はこのQRコードをお見せください」
↓
再来店時の受付が1秒で完了
```

## 入力支援・UX改善

### スマート予測変換
```javascript
// 車種入力時
「プリ」→「プリウス」「プリウスα」「プリウスPHV」
「フィ」→「フィット」「フィット ハイブリッド」

// 予算入力時
よく使われる価格帯をプリセット
[100-150万][150-200万][200-250万][250-300万]
```

### 入力時間短縮
- 必須項目のみで「今すぐ接客開始」可能
- 詳細情報は接客中または後で追記
- よく使う情報はワンタップ入力

### エラー防止
```typescript
// リアルタイムバリデーション
電話番号: 090-1234-5678 ✅
電話番号: 090-123-45 ❌「正しい電話番号を入力してください」

メール: yamada@example.com ✅  
メール: yamada@example ❌「正しいメール形式で入力してください」
```

## データベース連携

### 新規顧客テーブル
```sql
customers:
  customer_id (UUID, Primary Key)
  name_kanji (姓名)
  name_kana (ふりがな、音声入力から自動生成)
  phone (電話番号、ユニーク制約)
  email 
  visit_purpose (来店目的)
  companion_type (同伴者)
  preferred_vehicle (希望車種)
  budget_range (予算帯)
  usage_type (使用用途)
  first_visit_date (初回来店日)
  lead_source ('walk-in'|'phone'|'web'|'referral')
  assigned_staff_id (担当者ID)
  status ('new'|'in-progress'|'completed'|'dormant')
  created_at
  updated_at
```

### 重複チェック機能
```typescript
async function checkDuplicateCustomer(phone: string, email: string) {
  // 電話番号での重複チェック
  const existingByPhone = await supabase
    .from('customers')
    .select('*')
    .eq('phone', phone)
    .single();
    
  if (existingByPhone.data) {
    return {
      isDuplicate: true,
      existingCustomer: existingByPhone.data,
      matchType: 'phone'
    };
  }
  
  // メールアドレスでの重複チェック
  if (email) {
    const existingByEmail = await supabase
      .from('customers')
      .select('*')
      .eq('email', email)
      .single();
      
    if (existingByEmail.data) {
      return {
        isDuplicate: true,
        existingCustomer: existingByEmail.data,
        matchType: 'email'
      };
    }
  }
  
  return { isDuplicate: false };
}
```

## 完了後のアクション

### 即座に接客開始の場合
```
新規顧客登録完了
↓
自動的に顧客詳細画面に遷移
↓
「ニーズヒアリング」ボタンが強調表示
↓
スムーズに接客フローに移行
```

### 後で詳細入力の場合
```
基本情報のみ登録完了
↓
「タスク」に「○○様の詳細情報入力」を自動追加
↓
スタッフのToDoリストに表示
↓
時間があるときに詳細入力
```

## 成功指標

### 定量的指標
- 新規顧客登録時間: 5分 → 2分
- 入力エラー率: 10% → 3%
- 重複登録: 5% → 1%

### 定性的指標
- スタッフの「使いやすい」評価: 90%以上
- 顧客の待ち時間に対する不満: 50%削減

## 実装優先度

### Phase 1 (MVP)
- 基本的な入力フォーム
- 必須バリデーション
- 重複チェック
- 簡単な完了アクション

### Phase 2 (拡張)
- 免許証撮影・OCR機能
- 音声入力対応
- QRコード生成
- 高度な予測変換

### Phase 3 (最適化)
- AI による入力支援
- 顧客行動予測
- 自動タグ付け
- パーソナライズ対応