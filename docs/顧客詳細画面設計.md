# 顧客詳細画面設計

## 画面の目的
新規登録またはリピート顧客の全体的な状況を把握し、次のアクションを決定するハブ画面

## 表示される情報

### 1. 顧客基本情報エリア
- 顧客名、連絡先
- 初回来店日・最終来店日
- 担当者履歴
- 購買意欲スコア（AI算出）
- 顧客ステータス（新規/検討中/成約済み等）

### 2. 現在の商談状況
- アクティブな商談があるか
- 商談ステージ（初回接触/提案/交渉/クロージング）
- 次回予定アクション
- 進捗の可視化

### 3. 興味・ニーズ情報
- 希望車種・予算帯
- 使用用途・家族構成
- 重視するポイント
- 過去の問い合わせ履歴

### 4. マッチング情報（AI提案）
- おすすめ車両リスト
- 類似顧客の購買パターン
- 成約確率予測
- 最適な提案タイミング

### 5. コミュニケーション履歴
- 全チャネル統合タイムライン
- メール・電話・LINE・来店記録
- 担当者別の対応履歴
- 次回フォロー予定

### 6. クイックアクション
- ニーズヒアリング開始
- 在庫検索・車両提案
- 見積もり作成
- 試乗予約
- フォローアップ設定

## レイアウト構成（iPad横向き）

```
┌─────────────────────────────────────────────────────────┐
│ ← 戻る  山田太郎 様  📞 090-1234-5678  ✉ yamada@...     │
├─────────────────────────────────────────────────────────┤
│ [基本情報]    [商談状況]    [履歴]    [分析]           │
├─────────────────┬───────────────────┬───────────────────┤
│ 📋 基本情報        │ 🎯 クイックアクション    │ 📊 AI分析          │
│                   │                        │                   │
│ 初回来店: 8/28     │ [ニーズヒアリング]      │ 購買意欲: 85%      │
│ 担当: 田中         │ [在庫検索]             │ 成約確率: 67%      │
│ ステータス: 新規    │ [見積作成]             │ 推奨車種:          │
│                   │ [試乗予約]             │ プリウス (92%)     │
│ 希望車種: プリウス  │ [フォロー設定]          │ アクア (78%)       │
│ 予算: 200万円      │                        │                   │
│ 用途: 通勤用       │                        │ 類似顧客パターン:  │
│ 同伴: ご夫婦       │                        │ 平均検討期間14日    │
├─────────────────┴───────────────────┬───────────────────┤
│ 💬 コミュニケーション履歴                      │ 📋 商談進捗         │
│                                              │                   │
│ 8/28 14:30 [来店] 初回来店・登録完了          │ ステージ: 初回接触  │
│ 8/28 15:00 [試乗] プリウス試乗実施            │ 開始日: 8/28       │
│ 8/28 17:00 [メール] 見積書送付               │ 次回予定: 8/30     │
│ 8/29 09:00 [LINE] フォローメッセージ送信      │                   │
│ 8/29 14:00 [電話] 追加質問対応               │ 進捗バー:          │
│                                              │ ████████░░ 80%     │
└──────────────────────────────────────────┴───────────────────┘
```

## データ統合の仕組み

### リアルタイムデータ取得
```typescript
interface CustomerDetailData {
  // 基本情報（Supabase CRM）
  basicInfo: {
    customer_id: string;
    name: string;
    phone: string;
    email: string;
    first_visit_date: Date;
    assigned_staff_id: string;
    status: 'new' | 'in_progress' | 'contracted' | 'dormant';
  };
  
  // 商談情報（Supabase CRM）
  dealInfo: {
    deal_id?: string;
    stage: string;
    start_date: Date;
    next_action_date?: Date;
    probability: number;
  };
  
  // AI分析結果（BigQuery）
  aiAnalysis: {
    intent_score: number;
    conversion_probability: number;
    recommended_vehicles: Vehicle[];
    similar_customer_patterns: Pattern[];
  };
  
  // 在庫マッチング（EXTREME連携）
  inventoryMatches: {
    matching_vehicles: Vehicle[];
    availability_status: string;
    price_competitiveness: number;
  };
  
  // コミュニケーション履歴（統合）
  communications: Communication[];
}
```

### データ取得処理
```typescript
async function loadCustomerDetail(customerId: string) {
  // 並行してデータ取得
  const [
    basicInfo,
    dealInfo,
    aiAnalysis,
    inventoryMatches,
    communications
  ] = await Promise.all([
    fetchCustomerBasicInfo(customerId),
    fetchActiveDeal(customerId),
    fetchAIAnalysis(customerId),
    fetchInventoryMatches(customerId),
    fetchCommunicationHistory(customerId)
  ]);
  
  return {
    basicInfo,
    dealInfo,
    aiAnalysis,
    inventoryMatches,
    communications
  };
}
```

## インタラクション設計

### 1. タブ切り替え
- 基本情報、商談状況、履歴、分析の4タブ
- 情報量に応じて適切に分割
- アクティブタブを明確に表示

### 2. クイックアクション
- ワンタップで次の画面に遷移
- アクションボタンは大きく、わかりやすく
- 現在の状況に応じて推奨アクションを強調

### 3. リアルタイム更新
- WebSocket接続で情報をリアルタイム更新
- 他のスタッフの活動も表示
- 通知機能でアラート表示

## 画面遷移パターン

### 新規顧客の場合
1. 新規顧客登録完了 → 顧客詳細画面
2. 「ニーズヒアリング」推奨表示
3. ヒアリング → 在庫検索 → 見積作成の流れ

### 既存顧客の場合
1. 顧客検索 → 顧客詳細画面
2. 前回の続きから再開
3. 商談の進捗に応じた推奨アクション

### 問い合わせ経由の場合
1. 問い合わせ一覧 → 顧客詳細画面
2. 問い合わせ内容を強調表示
3. 即座に回答できるアクション提示

## 成功指標

### 定量的指標
- 画面滞在時間：平均2-3分
- クイックアクション使用率：80%以上
- 次画面への遷移率：90%以上

### 定性的指標
- スタッフが「顧客の状況がすぐわかる」
- 「次に何をすべきかが明確」
- 「過去の経緯を把握しやすい」

## 実装優先度

### Phase 1（必須）
- 基本情報表示
- 商談ステータス
- クイックアクション
- コミュニケーション履歴

### Phase 2（重要）
- AI分析結果表示
- 在庫マッチング
- リアルタイム更新
- 高度なフィルタリング

### Phase 3（拡張）
- 予測分析
- 自動化提案
- 詳細なレポート機能
- カスタマイズ可能なダッシュボード