# 車種マスタの安価実現方法

## 現状の課題
- 車種マスタの構築・維持にコストがかかる
- データの最新性を保つ必要がある
- 新型車・廃盤車の管理が必要

## 安価な実現方法

### 方法1: 無料API活用
**Yahoo!オークション車種API（無料枠）**
```javascript
// Yahoo!オークション車種情報取得
async function getCarModels(maker) {
  const response = await fetch(
    `https://auctions.yahooapis.jp/AuctionWebService/V2/categoryTree?appid=YOUR_APP_ID&category=26&adf=1`
  );
  // レスポンスから車種情報を抽出
}
```

**メリット**: 無料、データが豊富
**デメリット**: API制限、中古車中心

### 方法2: ウェブスクレイピング
**カーセンサー車種一覧を定期取得**
```javascript
// 週次でカーセンサーから車種情報を取得
async function scrapeCarSensorModels() {
  const makers = ['トヨタ', 'ホンダ', '日産', 'マツダ'];
  const models = {};
  
  for (const maker of makers) {
    const response = await fetch(`https://www.carsensor.net/usedcar/${maker}/`);
    // HTMLから車種名を抽出
    models[maker] = extractModels(response.html);
  }
  
  // Supabaseに保存
  await supabase.from('vehicle_models').upsert(models);
}
```

**メリット**: 最新データ、無料
**デメリット**: 不安定性、法的リスク

### 方法3: 静的データ + クラウドソーシング
**基本データを静的に用意 + 随時更新**
```javascript
// 基本車種データ（JSON）
const vehicleModels = {
  "トヨタ": [
    "プリウス", "プリウスα", "プリウスPHV",
    "アクア", "カローラ", "カムリ", "クラウン",
    "ヴィッツ", "ヤリス", "パッソ",
    "ハリアー", "RAV4", "ヴォクシー", "ノア"
  ],
  "ホンダ": [
    "フィット", "フィット ハイブリッド",
    "ヴェゼル", "シャトル", "フリード",
    "ステップワゴン", "オデッセイ"
  ],
  // ... 他メーカー
};

// クラウドワークス等で月1回更新（月額5,000円程度）
```

**メリット**: 安定性、コスト明確
**デメリット**: 手動更新必要

### 方法4: 学習型入力補完
**ユーザー入力から学習する方式**
```javascript
// 入力された車種を学習して候補に追加
function addVehicleModel(input) {
  const normalized = normalizeVehicleName(input);
  
  // 既存データに存在しない場合、候補に追加
  if (!existingModels.includes(normalized)) {
    suggestionModels.push(normalized);
    
    // 複数回入力されたら正式採用
    if (getInputCount(normalized) >= 3) {
      officialModels.push(normalized);
    }
  }
}

function normalizeVehicleName(input) {
  return input
    .replace(/[ァ-ヴ]/g, s => String.fromCharCode(s.charCodeAt(0) - 0x60)) // カナ→ひら
    .replace(/\s+/g, '') // 空白除去
    .toLowerCase();
}
```

**メリット**: 自動学習、ユーザビリティ向上
**デメリット**: 初期データ品質

## 推奨アプローチ

### Phase 1: 静的データ + 学習型（コスト: 月額0円）
```javascript
// 1. 基本的な車種データをJSONで用意（人気車種のみ約100車種）
const popularModels = {
  "トヨタ": ["プリウス", "アクア", "ヴィッツ", "カローラ", "ハリアー"],
  "ホンダ": ["フィット", "ヴェゼル", "フリード"],
  "日産": ["ノート", "セレナ", "エクストレイル"],
  // 最低限の人気車種のみ
};

// 2. ユーザー入力を蓄積・学習
async function handleVehicleInput(input) {
  // 既存データから検索
  const suggestions = searchExistingModels(input);
  
  // 新規入力の場合、学習データに追加
  if (suggestions.length === 0) {
    await addToLearningData(input);
  }
  
  return suggestions;
}

// 3. 月次で学習データをレビュー（スタッフが確認）
async function reviewLearningData() {
  const pendingModels = await getPendingModels();
  // 管理画面で承認・却下
  return pendingModels;
}
```

### Phase 2: 外部データ連携（コスト: 月額3,000-5,000円）
```javascript
// クラウドワーカーに月次更新を依頼
// または、Yahoo API等の有料枠を利用
```

## 実装例（プロトタイプ改善）

### 現在の実装改善
```javascript
// 改善版：よりインテリジェントな車種入力
class VehicleModelSuggestion {
  constructor() {
    this.popularModels = this.loadPopularModels();
    this.userInputs = new Map(); // 学習データ
  }
  
  async getSuggestions(input) {
    if (input.length < 2) return [];
    
    // 1. 人気車種から検索
    const popularMatches = this.searchPopular(input);
    
    // 2. 学習データから検索
    const learnedMatches = this.searchLearned(input);
    
    // 3. 曖昧一致（ひらがな・カタカナ・英字対応）
    const fuzzyMatches = this.fuzzySearch(input);
    
    // 重複除去して返却
    return [...new Set([...popularMatches, ...learnedMatches, ...fuzzyMatches])]
           .slice(0, 5);
  }
  
  searchPopular(input) {
    const results = [];
    Object.entries(this.popularModels).forEach(([maker, models]) => {
      models.forEach(model => {
        if (model.toLowerCase().includes(input.toLowerCase()) ||
            this.kanaConvert(model).includes(this.kanaConvert(input))) {
          results.push(`${model} (${maker})`);
        }
      });
    });
    return results;
  }
  
  kanaConvert(str) {
    return str.replace(/[ァ-ヴ]/g, s => 
      String.fromCharCode(s.charCodeAt(0) - 0x60)
    );
  }
}
```

## コスト比較

| 方法 | 初期コスト | 月額コスト | メンテナンス性 | データ品質 |
|------|------------|------------|---------------|------------|
| 静的データ + 学習 | 0円 | 0円 | ○ | △ |
| クラウドソーシング | 0円 | 5,000円 | ◎ | ◎ |
| 有料API | 0円 | 3,000円 | ◎ | ○ |
| 自社構築 | 50万円 | 10,000円 | △ | ◎ |

## 推奨実装手順

### Step 1: 最小コストで開始
1. 人気車種100台程度を手動でJSON作成
2. 入力補完機能を実装
3. ユーザー入力を蓄積

### Step 2: データ品質向上
1. 蓄積データを月次でレビュー
2. 承認された車種を正式データに追加
3. 必要に応じて外部データ連携検討

### Step 3: 自動化
1. スクレイピングまたはAPI連携
2. データ更新の自動化
3. 品質監視の仕組み構築

この方法なら、初期は完全無料で開始でき、必要に応じて段階的にコストをかけて品質向上できます。